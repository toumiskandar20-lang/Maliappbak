<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>Admin Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  font-family:Arial;
  background:#0f2027;
  color:#fff;
  margin:0;
}
.box{
  max-width:500px;
  margin:30px auto;
  background:#111;
  padding:20px;
  border-radius:15px;
}
.card{
  background:#222;
  padding:12px;
  border-radius:10px;
  margin:10px 0;
}
button{
  padding:8px 12px;
  margin:5px;
  border:none;
  border-radius:6px;
  cursor:pointer;
}
.approve{background:#00c853;}
.reject{background:#d50000;color:#fff;}
</style>
</head>

<body>

<div class="box">
  <h2>ğŸ› ï¸ Admin Dashboard</h2>
  <div id="withdrawList">ØªØ­Ù…ÙŠÙ„...</div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
import { 
  getFirestore, collection, getDocs, doc, updateDoc, getDoc 
} from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBfMUa-8vsUZ_1r5F79iSKOKqMre99lwbI",
  authDomain: "maliapp-63f91.firebaseapp.com",
  projectId: "maliapp-63f91"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

// ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø£Ø¯Ù…Ù†
onAuthStateChanged(auth, async user=>{
  if(!user){
    alert("âŒ ØºÙŠØ± Ù…Ø³Ø¬Ù„");
    location.href="index.html";
    return;
  }

  const snap = await getDoc(doc(db,"users",user.uid));
  if(!snap.exists() || !snap.data().isAdmin){
    alert("âŒ Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ ØµÙ„Ø§Ø­ÙŠØ©");
    location.href="index.html";
    return;
  }

  loadWithdrawals();
});

// ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³Ø­ÙˆØ¨Ø§Øª
async function loadWithdrawals(){
  const list = document.getElementById("withdrawList");
  list.innerHTML = "";

  const snap = await getDocs(collection(db,"withdrawals"));

  snap.forEach(d=>{
    const w = d.data();
    if(w.status !== "pending") return;

    list.innerHTML += `
      <div class="card">
        ğŸ‘¤ ${w.userId}<br>
        ğŸ’° ${w.amount}<br>
        ğŸ“Œ ${w.status}
        <br>
        <button class="approve" onclick="approve('${d.id}')">Ù‚Ø¨ÙˆÙ„</button>
        <button class="reject" onclick="reject('${d.id}')">Ø±ÙØ¶</button>
      </div>
    `;
  });
}

// Ù‚Ø¨ÙˆÙ„
window.approve = async (id)=>{
  await updateDoc(doc(db,"withdrawals",id),{
    status:"approved"
  });
  alert("âœ… ØªÙ… Ø§Ù„Ù‚Ø¨ÙˆÙ„");
  loadWithdrawals();
}

// Ø±ÙØ¶
window.reject = async (id)=>{
  await updateDoc(doc(db,"withdrawals",id),{
    status:"rejected"
  });
  alert("âŒ ØªÙ… Ø§Ù„Ø±ÙØ¶");
  loadWithdrawals();
}
</script>

</body>
</html>
