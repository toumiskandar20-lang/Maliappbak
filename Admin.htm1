<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>Admin Dashboard - MaliApp</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{
  background:#0f2027;
  color:#fff;
  font-family:Arial;
}
.box{
  max-width:500px;
  margin:30px auto;
  background:#111;
  padding:20px;
  border-radius:12px;
}
.card{
  background:#222;
  padding:12px;
  margin:8px 0;
  border-radius:8px;
}
button{
  padding:8px 12px;
  margin-top:6px;
  border:none;
  border-radius:6px;
  cursor:pointer;
}
.approve{background:#00c853;}
.reject{background:#d50000;color:#fff;}
</style>
</head>

<body>

<div class="box">
  <h2>ğŸ›  Admin Dashboard</h2>
  <div id="withdrawList">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
import { 
  getFirestore, doc, getDoc, collection, getDocs, updateDoc 
} from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBfMUa-8vsUZ_1r5F79iSKOKqMre99lwbI",
  authDomain: "maliapp-63f91.firebaseapp.com",
  projectId: "maliapp-63f91",
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

// ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø£Ø¯Ù…Ù†
onAuthStateChanged(auth, async user=>{
  if(!user){
    alert("Ù„Ø§Ø²Ù… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„");
    location.href="index.html";
    return;
  }

  const snap = await getDoc(doc(db,"users",user.uid));
  if(!snap.exists() || snap.data().role !== "admin"){
    alert("âŒ Ø¯Ø®ÙˆÙ„ ØºÙŠØ± Ù…ØµØ±Ø­");
    return;
  }

  loadWithdrawals();
});

// ØªØ­Ù…ÙŠÙ„ Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø³Ø­Ø¨
async function loadWithdrawals(){
  const list = document.getElementById("withdrawList");
  list.innerHTML = "";

  const snap = await getDocs(collection(db,"withdrawals"));
  snap.forEach(d=>{
    const w = d.data();
    if(w.status !== "pending") return;

    list.innerHTML += `
      <div class="card">
        ğŸ‘¤ ${w.userId}<br>
        ğŸ’° ${w.amount}<br>
        <button class="approve" onclick="approve('${d.id}')">Ù‚Ø¨ÙˆÙ„</button>
        <button class="reject" onclick="reject('${d.id}')">Ø±ÙØ¶</button>
      </div>
    `;
  });
}

// Ù‚Ø¨ÙˆÙ„
window.approve = async(id)=>{
  await updateDoc(doc(db,"withdrawals",id),{status:"approved"});
  loadWithdrawals();
}

// Ø±ÙØ¶
window.reject = async(id)=>{
  await updateDoc(doc(db,"withdrawals",id),{status:"rejected"});
  loadWithdrawals();
}
</script>

</body>
</html>
