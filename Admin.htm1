<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>Admin Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
import { getFirestore, collection, getDocs, doc, updateDoc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBfMUa-8vsUZ_1r5F79iSKOKqMre99lwbI",
  authDomain: "maliapp-63f91.firebaseapp.com",
  projectId: "maliapp-63f91",
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

onAuthStateChanged(auth, async (user) => {
  if (!user) {
    alert("Ù„Ø§Ø²Ù… ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„");
    return;
  }

  loadUsers();
});

async function loadUsers() {
  const usersCol = collection(db, "users");
  const snapshot = await getDocs(usersCol);
  const container = document.getElementById("users");

  container.innerHTML = "";

  snapshot.forEach(docu => {
    const u = docu.data();
    if (u.role === "user") {
      container.innerHTML += `
        <div class="card">
          <p>ðŸ“§ ${u.email}</p>
          <p>ðŸ’° Ø§Ù„Ø±ØµÙŠØ¯: ${u.balance}</p>
          <input type="number" id="bal-${docu.id}" placeholder="Ø±ØµÙŠØ¯ Ø¬Ø¯ÙŠØ¯">
          <button onclick="updateBalance('${docu.id}')">ØªØ­Ø¯ÙŠØ«</button>
        </div>
      `;
    }
  });
}

window.updateBalance = async function(uid) {
  const val = document.getElementById(`bal-${uid}`).value;
  if (!val) return alert("Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù…");

  await updateDoc(doc(db, "users", uid), {
    balance: Number(val)
  });

  alert("ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ« âœ…");
  loadUsers();
}
</script>

<style>
body { font-family:Arial; background:#f4f6f8; padding:20px }
.card {
  background:#fff;
  padding:15px;
  border-radius:10px;
  margin-bottom:10px;
}
button {
  background:#2575fc;
  color:white;
  border:none;
  padding:6px 10px;
  border-radius:6px;
}
</style>
</head>

<body>
<h2>ðŸ›  Admin Dashboard</h2>
<div id="users"></div>
</body>
</html>
