<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>Admin Dashboard - MaliApp</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getFirestore, collection, query, where, getDocs, updateDoc, doc } 
from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";
import { getAuth, signInWithEmailAndPassword } 
from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyBfMUa-8vsUZ_1r5F79iSKOKqMre99lwbI",
  authDomain: "maliapp-63f91.firebaseapp.com",
  projectId: "maliapp-63f91",
  storageBucket: "maliapp-63f91.appspot.com",
  messagingSenderId: "901870433172",
  appId: "1:901870433172:web:325b2312af72099279d581"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);

// ğŸ” ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Admin
window.adminLogin = async () => {
  const email = adminEmail.value;
  const pass = adminPass.value;

  try {
    await signInWithEmailAndPassword(auth, email, pass);
    document.getElementById("login").style.display = "none";
    document.getElementById("panel").style.display = "block";
    loadWithdrawals();
  } catch (e) {
    alert("âŒ ÙØ´Ù„ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„");
  }
};

// ğŸ“¥ ØªØ­Ù…ÙŠÙ„ Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø³Ø­Ø¨
async function loadWithdrawals() {
  const q = query(
    collection(db, "withdrawals"),
    where("status", "==", "pending")
  );

  const snap = await getDocs(q);
  const box = document.getElementById("requests");
  box.innerHTML = "";

  snap.forEach(d => {
    const w = d.data();
    box.innerHTML += `
      <div class="card">
        <p>ğŸ“§ ${w.email}</p>
        <p>ğŸ’° ${w.amount}</p>
        <button onclick="approve('${d.id}')">âœ… Ù‚Ø¨ÙˆÙ„</button>
        <button onclick="reject('${d.id}')">âŒ Ø±ÙØ¶</button>
      </div>
    `;
  });
}

// âœ… Ù‚Ø¨ÙˆÙ„
window.approve = async (id) => {
  await updateDoc(doc(db, "withdrawals", id), {
    status: "approved"
  });
  loadWithdrawals();
};

// âŒ Ø±ÙØ¶
window.reject = async (id) => {
  await updateDoc(doc(db, "withdrawals", id), {
    status: "rejected"
  });
  loadWithdrawals();
};
</script>

<style>
body{
  font-family:Arial;
  background:#0f2027;
  color:#fff;
}
.box{
  max-width:400px;
  margin:40px auto;
  background:#111;
  padding:20px;
  border-radius:12px;
}
input,button{
  width:100%;
  padding:10px;
  margin:6px 0;
  border-radius:6px;
  border:none;
}
button{
  background:#00c853;
  font-weight:bold;
}
.card{
  background:#222;
  padding:10px;
  border-radius:8px;
  margin:10px 0;
}
</style>
</head>

<body>

<div class="box" id="login">
  <h3>ğŸ” Admin Login</h3>
  <input id="adminEmail" placeholder="Admin Email">
  <input id="adminPass" type="password" placeholder="Password">
  <button onclick="adminLogin()">Ø¯Ø®ÙˆÙ„</button>
</div>

<div class="box" id="panel" style="display:none">
  <h3>ğŸ“¥ Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø³Ø­Ø¨</h3>
  <div id="requests"></div>
</div>

</body>
</html>
