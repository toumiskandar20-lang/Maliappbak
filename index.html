<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>maliapp</title>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<style>
body{font-family:Arial; background:#121212; color:#fff; direction:rtl;}
.container{max-width:400px; margin:40px auto; background:#1b1b1b; padding:20px; border-radius:10px; box-shadow:0 0 10px #0f0;}
h2{text-align:center;color:#0f0;}
input,button,textarea{width:100%; padding:10px; margin:6px 0; border-radius:6px; border:1px solid #0f0; background:#121212; color:#fff;}
button{background:#0f0; color:#000; border:none;}
.menu button{background:#222; color:#0f0; margin:3px 0;}
.hidden{display:none}
.box{background:#1a1a1a; padding:10px; border-radius:6px; margin:10px 0; border:1px solid #0f0;}
</style>
</head>
<body>

<div class="container" id="login">
<h2>maliapp ğŸ’°</h2>
<input id="email" placeholder="Ø¥ÙŠÙ…ÙŠÙ„">
<input id="pass" type="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
<button onclick="login()">Ø¯Ø®ÙˆÙ„ / ØªØ³Ø¬ÙŠÙ„</button>
</div>

<div class="container hidden" id="app">
<h2>maliapp ğŸ’°</h2>

<div class="box">
Ø±ØµÙŠØ¯Ùƒ: <b><span id="balance">0</span> Ù…Ø§Ù„ÙŠ</b><br>
ÙØ±ÙŠÙ‚Ùƒ: <b><span id="team">0</span></b>
</div>

<div class="menu">
<button onclick="show('tasks')">ğŸ“‹ Ø§Ù„Ù…Ù‡Ø§Ù…</button>
<button onclick="show('ref')">ğŸ”— Ø±Ø§Ø¨Ø· Ø§Ù„Ø¯Ø¹ÙˆØ©</button>
<button onclick="show('withdraw')">ğŸ’¸ Ø·Ù„Ø¨ Ø³Ø­Ø¨</button>
<button onclick="show('support')">ğŸ“ Ø§Ù„Ø¯Ø¹Ù…</button>
<button onclick="logout()">ğŸšª Ø®Ø±ÙˆØ¬</button>
</div>

<div id="tasks" class="hidden">
<h3>ğŸ“‹ Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„ÙŠÙˆÙ…ÙŠØ©</h3>
<button onclick="task()">Ø¥Ù†Ø¬Ø§Ø² Ù…Ù‡Ù…Ø© (+5 Ù…Ø§Ù„ÙŠ)</button>
</div>

<div id="ref" class="hidden">
<h3>ğŸ”— Ø±Ø§Ø¨Ø· Ø§Ù„Ø¯Ø¹ÙˆØ©</h3>
<div class="box" id="reflink"></div>
<button onclick="invite()">Ù…Ø­Ø§ÙƒØ§Ø© Ø¯Ø®ÙˆÙ„ Ø¹Ø¶Ùˆ (+1 Ù…Ø§Ù„ÙŠ)</button>
</div>

<div id="withdraw" class="hidden">
<h3>ğŸ’¸ Ø·Ù„Ø¨ Ø³Ø­Ø¨</h3>
<input id="amount" placeholder="Ø§Ù„Ù…Ø¨Ù„Øº">
<button onclick="withdraw()">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨</button>
<div id="wmsg"></div>
</div>

<div id="support" class="hidden">
<h3>ğŸ“ Ø§Ù„Ø¯Ø¹Ù…</h3>
<textarea id="supportMsg" placeholder="Ø§ÙƒØªØ¨ Ù…Ø´ÙƒÙ„ØªÙƒ"></textarea>
<button onclick="sendSupport()">Ø¥Ø±Ø³Ø§Ù„</button>
<div id="smsg"></div>
</div>

<script>
// âš¡ Firebase Config
const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_PROJECT.firebaseapp.com",
  databaseURL: "https://YOUR_PROJECT.firebaseio.com",
  projectId: "YOUR_PROJECT",
  storageBucket: "YOUR_PROJECT.appspot.com",
  messagingSenderId: "XXXX",
  appId: "XXXX"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.database();

let currentUser = null;
let refcode = "";

function login(){
  const email = document.getElementById("email").value;
  const pass = document.getElementById("pass").value;
  auth.signInWithEmailAndPassword(email, pass)
  .then(user=>{currentUser=user.user; loadUser();})
  .catch(err=>{
    // Ø¥Ø°Ø§ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯ØŒ Ù†Ø³Ø¬Ù‘Ù„Ù‡
    auth.createUserWithEmailAndPassword(email, pass)
    .then(user=>{currentUser=user.user; loadUser();})
    .catch(e=>alert(e.message));
  });
}

function loadUser(){
  refcode = "REF" + Math.floor(Math.random()*9999);
  db.ref("users/"+currentUser.uid).once("value").then(snapshot=>{
    if(!snapshot.exists()){
      db.ref("users/"+currentUser.uid).set({
        balance:0,
        team:0,
        refcode:refcode
      });
    }else{
      const data = snapshot.val();
      refcode = data.refcode;
    }
    document.getElementById("login").classList.add("hidden");
    document.getElementById("app").classList.remove("hidden");
    document.getElementById("reflink").innerText = location.href + "?ref=" + refcode;
    update();
  });
}

function update(){
  db.ref("users/"+currentUser.uid).once("value").then(s=>{
    const data = s.val();
    document.getElementById("balance").innerText = data.balance;
    document.getElementById("team").innerText = data.team;
  });
}

function show(id){
  document.querySelectorAll("#app > div").forEach(d=>d.classList.add("hidden"));
  document.getElementById(id).classList.remove("hidden");
}

// ğŸ“ Ø§Ù„Ù…Ù‡Ø§Ù…
function task(){
  db.ref("users/"+currentUser.uid).once("value").then(s=>{
    let bal = s.val().balance;
    bal += 5;
    db.ref("users/"+currentUser.uid+"/balance").set(bal);
    update();
    alert("ØªÙ…Øª Ø§Ù„Ù…Ù‡Ù…Ø© âœ”ï¸");
  });
}

// ğŸ”— Ø¯Ø¹ÙˆØ©
function invite(){
  db.ref("users/"+currentUser.uid).once("value").then(s=>{
    let bal = s.val().balance;
    let team = s.val().team;
    bal += 1;
    team +=1;
    db.ref("users/"+currentUser.uid).update({balance:bal,team:team});
    update();
  });
}

// ğŸ’¸ Ø³Ø­Ø¨
function withdraw(){
  const a = Number(document.getElementById("amount").value);
  db.ref("users/"+currentUser.uid).once("value").then(s=>{
    let bal = s.val().balance;
    if(a>bal){
      document.getElementById("wmsg").innerText="Ø±ØµÙŠØ¯ ØºÙŠØ± ÙƒØ§ÙÙŠ";
    }else{
      bal -= a;
      db.ref("users/"+currentUser.uid+"/balance").set(bal);
      db.ref("withdrawals").push({uid:currentUser.uid,amount:a,date:Date.now()});
      document.getElementById("wmsg").innerText="ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø§Ù„Ø³Ø­Ø¨ âœ”ï¸";
      update();
    }
  });
}

// ğŸ“ Ø¯Ø¹Ù…
function sendSupport(){
  const msg = document.getElementById("supportMsg").value;
  if(msg==""){return;}
  db.ref("support").push({uid:currentUser.uid,message:msg,date:Date.now()});
  document.getElementById("smsg").innerText="ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ âœ”ï¸";
  document.getElementById("supportMsg").value="";
}

function logout(){
  auth.signOut();
  location.reload();
}

// ğŸ”„ Ø¥Ø°Ø§ Ù…Ø³Ø¬Ù„
auth.onAuthStateChanged(u=>{
  if(u){currentUser=u; loadUser();}
});
</script>

</body>
</html>
