<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>Mali App</title>
<style>
body{font-family:Arial;background:#111;color:#fff}
.hidden{display:none}
.task{background:#222;padding:10px;margin:10px;border-radius:8px}
button{margin:5px;padding:5px 10px}
#levelUpOverlay{
  position:fixed;inset:0;
  background:rgba(0,0,0,.7);
  display:flex;align-items:center;justify-content:center;
  opacity:0;pointer-events:none;transition:.3s
}
#levelUpOverlay.show{opacity:1;pointer-events:auto}
.popup{background:#1e1e1e;padding:30px;border-radius:12px;text-align:center}
</style>
</head>

<body>

<h2>âš½ Ù…Ù‡Ø§Ù… Ø§Ù„ÙŠÙˆÙ… (Ø§Ù„Ù…Ø¨Ø§Ø±ÙŠØ§Øª)</h2>
<div id="matchesBox"></div>

<button onclick="openUpgrade()">â¬†ï¸ ØªØ±Ù‚ÙŠØ© Ø§Ù„Ù…Ø³ØªÙˆÙ‰</button>
<button onclick="logout()">ğŸšª Ø®Ø±ÙˆØ¬</button>

<div id="upgradeBox" class="hidden">
  <h3>Ø§Ù„ØªØ±Ù‚ÙŠØ©</h3>
  <button onclick="upgradeLevel(2)">Ù…Ø³ØªÙˆÙ‰ 2</button>
  <button onclick="upgradeLevel(3)">Ù…Ø³ØªÙˆÙ‰ 3</button>
  <button onclick="back()">â¬… Ø±Ø¬ÙˆØ¹</button>
</div>

<!-- Popup -->
<div id="levelUpOverlay">
  <div class="popup">
    <h2>ğŸ‰ ØªÙ…Øª Ø§Ù„ØªØ±Ù‚ÙŠØ©!</h2>
    <p>ÙˆØµÙ„Øª Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø³ØªÙˆÙ‰ <span id="popupLevel"></span></p>
  </div>
</div>

<audio id="levelUpSound" preload="auto">
  <source src="level-up.mp3" type="audio/mpeg">
</audio>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import {
  getAuth,createUserWithEmailAndPassword,
  signInWithEmailAndPassword,onAuthStateChanged,signOut
} from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
import {
  getFirestore,doc,setDoc,getDoc,updateDoc
} from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

/* ğŸ”¥ Firebase */
const firebaseConfig={
  apiKey:"PUT_YOUR_KEY",
  authDomain:"PUT_YOUR_DOMAIN",
  projectId:"PUT_YOUR_ID"
};
const app=initializeApp(firebaseConfig);
const auth=getAuth(app);
const db=getFirestore(app);

/* ğŸ§  Ø¨ÙŠØ§Ù†Ø§Øª */
let userData={}, userBets={};

const LEVELS={
  1:{reward:0.5},
  2:{reward:1.5,price:230},
  3:{reward:3,price:590}
};

/* âš½ Ø§Ù„Ù…Ø¨Ø§Ø±ÙŠØ§Øª (Ù…Ø¤Ù‚ØªÙ‹Ø§ Ù…Ø­Ù„ÙŠØ©) */
const matches=[
  {id:1,teamA:"ØªÙˆÙ†Ø³",teamB:"Ø§Ù„Ù…ØºØ±Ø¨",start:"2025-12-25T18:00:00Z",result:null},
  {id:2,teamA:"Ø§Ù„Ù…ØºØ±Ø¨",teamB:"Ù…ØµØ±",start:"2025-12-25T21:00:00Z",result:null}
];

/* ğŸ” Auth */
onAuthStateChanged(auth,async(user)=>{
  if(!user){
    const email=prompt("Email");
    const pass=prompt("Password");
    await createUserWithEmailAndPassword(auth,email,pass);
    return;
  }

  const ref=doc(db,"users",user.uid);
  const snap=await getDoc(ref);
  if(!snap.exists()){
    userData={balance:0,level:1};
    await setDoc(ref,userData);
  }else userData=snap.data();

  loadMatches();
});

/* âš½ Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø¨Ø§Ø±ÙŠØ§Øª */
function loadMatches(){
  matchesBox.innerHTML="";
  const now=new Date();

  matches.forEach(m=>{
    const start=new Date(m.start);
    const canBet=now<start;

    matchesBox.innerHTML+=`
      <div class="task">
        ${m.teamA} ğŸ†š ${m.teamB}<br>
        <small>${start.toLocaleString()}</small><br>
        <button ${!canBet?"disabled":""} onclick="placeBet(${m.id},'1')">1</button>
        <button ${!canBet?"disabled":""} onclick="placeBet(${m.id},'X')">X</button>
        <button ${!canBet?"disabled":""} onclick="placeBet(${m.id},'2')">2</button>
      </div>
    `;
  });
}

/* ğŸ¯ Ø§Ù„ØªÙƒÙ‡Ù† */
window.placeBet=(id,bet)=>{
  if(userBets[id]) return alert("ØªÙ… Ø§Ù„ØªÙƒÙ‡Ù† Ù…Ø³Ø¨Ù‚Ù‹Ø§");
  userBets[id]={bet,paid:false};
  alert("ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØªÙƒÙ‡Ù† âœ”");
};

/* ğŸ’° ÙØ­Øµ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ (Ù…Ø­Ù…ÙŠ Ù…Ù† Ø§Ù„ØªÙƒØ±Ø§Ø±) */
setInterval(async()=>{
  for(const m of matches){
    if(m.result && userBets[m.id] && !userBets[m.id].paid){
      if(userBets[m.id].bet===m.result){
        userBets[m.id].paid=true;
        userData.balance+=LEVELS[userData.level].reward;
        await updateDoc(doc(db,"users",auth.currentUser.uid),userData);
        alert("ğŸ‰ Ø±Ø¨Ø­Øª!");
      }
    }
  }
},60000);

/* â¬†ï¸ Ø§Ù„ØªØ±Ù‚ÙŠØ© */
window.upgradeLevel=async(lvl)=>{
  const p=LEVELS[lvl].price;
  if(userData.balance<p) return alert("Ø±ØµÙŠØ¯ ØºÙŠØ± ÙƒØ§Ù");
  userData.balance-=p;
  userData.level=lvl;
  await updateDoc(doc(db,"users",auth.currentUser.uid),userData);
  showLevelUp(lvl);
};

/* ğŸŒŸ Popup */
const levelUpSound=document.getElementById("levelUpSound");
window.showLevelUp=(lvl)=>{
  popupLevel.innerText=lvl;
  levelUpSound.play();
  levelUpOverlay.classList.add("show");
  setTimeout(()=>levelUpOverlay.classList.remove("show"),3000);
};

/* NAV */
window.openUpgrade=()=>upgradeBox.classList.remove("hidden");
window.back=()=>upgradeBox.classList.add("hidden");
window.logout=()=>signOut(auth);
</script>

</body>
</html>
