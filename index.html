<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>MaliApp</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Firebase -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
  import { 
    getAuth, 
    createUserWithEmailAndPassword,
    signInWithEmailAndPassword 
  } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
  import { 
    getFirestore,
    doc,
    setDoc,
    serverTimestamp
  } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBfMUa-8vsUZ_1r5F79iSKOKqMre99lwbI",
    authDomain: "maliapp-63f91.firebaseapp.com",
    projectId: "maliapp-63f91",
    storageBucket: "maliapp-63f91.appspot.com",
    messagingSenderId: "901870433172",
    appId: "1:901870433172:web:325b2312af72099279d581"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  // ğŸ” ØªØ³Ø¬ÙŠÙ„ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯
  window.register = async function () {
    const phone = document.getElementById("phone").value.trim();
    const email = document.getElementById("email").value.trim();
    const password = document.getElementById("password").value;
    const confirm = document.getElementById("confirm").value;
    const invite = document.getElementById("invite").value.trim();

    // ğŸ›‘ ØªØ­Ù‚Ù‚
    if (!phone || !email || !password || !confirm) {
      alert("âŒ Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ¹Ù…ÙŠØ± ÙƒÙ„ Ø§Ù„Ø®Ø§Ù†Ø§Øª");
      return;
    }
    if (password.length < 6) {
      alert("âŒ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ù„Ø§Ø²Ù…Ù‡Ø§ 6 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„");
      return;
    }
    if (password !== confirm) {
      alert("âŒ ÙƒÙ„Ù…ØªØ§ Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± Ù…ØªØ·Ø§Ø¨Ù‚ØªÙŠÙ†");
      return;
    }

    try {
      const userCred = await createUserWithEmailAndPassword(auth, email, password);
      const user = userCred.user;

      // ğŸ Ø±Ø§Ø¨Ø· Ø¯Ø¹ÙˆØ© Ø®Ø§Øµ
      const myInviteCode = Math.floor(100000 + Math.random() * 900000).toString();

      // ğŸ§¾ ØªØ®Ø²ÙŠÙ† ÙÙŠ Firestore
      await setDoc(doc(db, "users", user.uid), {
        phone: phone,
        email: email,
        balance: 0,
        level: 1,
        inviteCode: myInviteCode,
        invitedBy: invite || null,
        createdAt: serverTimestamp()
      });

      alert("âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¨Ù†Ø¬Ø§Ø­");
      showApp();

    } catch (error) {
      alert("âŒ " + error.message);
    }
  };

  // ğŸ”‘ ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„
  window.login = async function () {
    const email = document.getElementById("loginEmail").value.trim();
    const password = document.getElementById("loginPassword").value;

    if (!email || !password) {
      alert("âŒ Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„ ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±");
      return;
    }

    try {
      await signInWithEmailAndPassword(auth, email, password);
      alert("ğŸ‰ Ù…Ø±Ø­Ø¨Ø§ Ø¨ÙŠÙƒ");
      showApp();
    } catch (error) {
      alert("âŒ " + error.message);
    }
  };

  function showApp() {
    document.getElementById("auth").style.display = "none";
    document.getElementById("app").style.display = "block";
  }
</script>

<style>
body{
  font-family:Arial;
  background:linear-gradient(135deg,#6a11cb,#2575fc);
  min-height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
}
.box{
  background:#fff;
  width:330px;
  padding:20px;
  border-radius:14px;
  box-shadow:0 15px 40px rgba(0,0,0,.3);
}
input,button{
  width:100%;
  padding:10px;
  margin:6px 0;
  border-radius:6px;
  border:1px solid #ccc;
}
button{
  background:#2575fc;
  color:#fff;
  border:none;
  font-size:16px;
}
hr{margin:10px 0;}
</style>
</head>

<body>

<div class="box" id="auth">
  <h2>ğŸ†• ØªØ³Ø¬ÙŠÙ„ Ø­Ø³Ø§Ø¨</h2>
  <input id="phone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ">
  <input id="email" type="email" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ">
  <input id="password" type="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
  <input id="confirm" type="password" placeholder="ØªØ£ÙƒÙŠØ¯ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
  <input id="invite" placeholder="Ø±Ù…Ø² Ø§Ù„Ø¯Ø¹ÙˆØ© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)">
  <button onclick="register()">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</button>

  <hr>

  <h3>ğŸ”‘ ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„</h3>
  <input id="loginEmail" type="email" placeholder="Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„">
  <input id="loginPassword" type="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
  <button onclick="login()">Ø¯Ø®ÙˆÙ„</button>
</div>

<div class="box" id="app" style="display:none">
  <h2>ğŸ‰ Ù…Ø±Ø­Ø¨Ø§ Ø¨Ùƒ ÙÙŠ MaliApp</h2>
  <p>Ø§Ù„ØªØ³Ø¬ÙŠÙ„ ÙˆØ§Ù„Ø¯Ø®ÙˆÙ„ Ø®Ø¯Ø§Ù…ÙŠÙ† ğŸ”</p>
</div>

</body>
</html>
