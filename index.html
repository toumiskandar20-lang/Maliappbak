<!DOCTYPE html><div class="box">
  <h3>ğŸ’° Ø³Ø­Ø¨ Ø±Ø§ØªØ¨</h3>

  <input id="withdrawAmount" type="number" placeholder="Ø£Ø¯Ø®Ù„ Ù…Ø¨Ù„Øº Ø§Ù„Ø³Ø­Ø¨">
  <button onclick="requestWithdraw()">Ø·Ù„Ø¨ Ø³Ø­Ø¨</button>

  <h3>ğŸ“œ Ø³Ø¬Ù„ Ø§Ù„Ø³Ø­ÙˆØ¨Ø§Øª</h3>
  <div id="withdrawHistory"></div>
</div>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>MaliApp</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Icons -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">

<!-- Firebase -->
<script type="module"><script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
import { 
  getFirestore, collection, addDoc, query, where, getDocs, serverTimestamp 
} from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBfMUa-8vsUZ_1r5F79iSKOKqMre99lwbI",
  authDomain: "maliapp-63f91.firebaseapp.com",
  projectId: "maliapp-63f91",
  storageBucket: "maliapp-63f91.appspot.com",
  messagingSenderId: "901870433172",
  appId: "1:901870433172:web:325b2312af72099279d581"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

// ğŸ”¹ Ø·Ù„Ø¨ Ø³Ø­Ø¨
window.requestWithdraw = async function () {
  const amount = Number(document.getElementById("withdrawAmount").value);

  if (!amount || amount <= 0) {
    alert("âŒ Ø£Ø¯Ø®Ù„ Ù…Ø¨Ù„Øº ØµØ­ÙŠØ­");
    return;
  }

  const user = auth.currentUser;
  if (!user) {
    alert("âŒ ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„");
    return;
  }

  await addDoc(collection(db, "withdrawals"), {
    userId: user.uid,
    email: user.email,
    amount: amount,
    status: "pending",
    createdAt: serverTimestamp()
  });

  alert("âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø§Ù„Ø³Ø­Ø¨ (Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©)");
  document.getElementById("withdrawAmount").value = "";
  loadWithdrawHistory();
};

// ğŸ”¹ ØªØ­Ù…ÙŠÙ„ Ø³Ø¬Ù„ Ø§Ù„Ø³Ø­ÙˆØ¨Ø§Øª
async function loadWithdrawHistory() {
  const user = auth.currentUser;
  if (!user) return;

  const q = query(
    collection(db, "withdrawals"),
    where("userId", "==", user.uid)
  );

  const snapshot = await getDocs(q);
  const container = document.getElementById("withdrawHistory");
  container.innerHTML = "";

  snapshot.forEach(doc => {
    const d = doc.data();
    let statusText = "â³ Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©";
    if (d.status === "approved") statusText = "âœ… ØªÙ… Ø§Ù„Ù‚Ø¨ÙˆÙ„";
    if (d.status === "rejected") statusText = "âŒ Ù…Ø±ÙÙˆØ¶";

    container.innerHTML += `
      <div style="background:#f1f1f1;padding:10px;margin:5px;border-radius:6px">
        ğŸ’µ ${d.amount} <br>
        ğŸ“Œ ${statusText}
      </div>
    `;
  });
}

// ğŸ”¹ Ø¹Ù†Ø¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
onAuthStateChanged(auth, user => {
  if (user) {
    loadWithdrawHistory();
  }
});
</script>
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
import { getFirestore, doc, setDoc, getDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";
import { getFirestore, collection, addDoc, serverTimestamp, query, where, getDocs } 
from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

const db = getFirestore(app);

// ØªÙ‚Ø¯ÙŠÙ… Ø·Ù„Ø¨ Ø³Ø­Ø¨
window.requestWithdraw = async function () {
  const amount = Number(document.getElementById("withdrawAmount").value);
  if (amount <= 0) {
    alert("âŒ Ù…Ø¨Ù„Øº ØºÙŠØ± ØµØ­ÙŠØ­");
    return;
  }

  const user = auth.currentUser;
  if (!user) return;

  await addDoc(collection(db, "withdraw_requests"), {
    userId: user.uid,
    email: user.email,
    amount: amount,
    status: "pending",
    createdAt: serverTimestamp()
  });

  alert("âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø§Ù„Ø³Ø­Ø¨ (ØªØ­Øª Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©)");
  loadWithdrawHistory();
};window.loadWithdrawHistory = async function () {
  const user = auth.currentUser;
  const q = query(
    collection(db, "withdraw_requests"),
    where("userId", "==", user.uid)
  );

  const snapshot = await getDocs(q);
  const list = document.getElementById("history");
  list.innerHTML = "";

  snapshot.forEach(doc => {
    const d = doc.data();
    list.innerHTML += `
      <div>
        ğŸ’° ${d.amount} | 
        Ø§Ù„Ø­Ø§Ù„Ø©: ${d.status === "pending" ? "â³ ØªØ­Øª Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©" : "âœ… ØªÙ… Ø§Ù„Ù‚Ø¨ÙˆÙ„"}
      </div>
    `;
  });
};
const firebaseConfig = {
  apiKey: "AIzaSyBfMUa-8vsUZ_1r5F79iSKOKqMre99lwbI",
  authDomain: "maliapp-63f91.firebaseapp.com",
  projectId: "maliapp-63f91",
  storageBucket: "maliapp-63f91.appspot.com",
  messagingSenderId: "901870433172",
  appId: "1:901870433172:web:325b2312af72099279d581"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

let currentTask = false;
let userData = null;

// ================= AUTH =================
window.register = async () => {
  const email = emailInput.value;
  const pass = passInput.value;
  if(pass.length < 6) return alert("ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø¶Ø¹ÙŠÙØ©");

  const cred = await createUserWithEmailAndPassword(auth, email, pass);
  const uid = cred.user.uid;

  const invite = uid.slice(0,6);

  await setDoc(doc(db,"users",uid),{
    balance:0,
    level:1,
    invite,
    wallet:"",
    tasks:{}
  });

  loadApp(uid);
};

window.login = async () => {
  const email = emailInput.value;
  const pass = passInput.value;
  const cred = await signInWithEmailAndPassword(auth,email,pass);
  loadApp(cred.user.uid);
};

async function loadApp(uid){
  const snap = await getDoc(doc(db,"users",uid));
  userData = snap.data();
  authBox.style.display="none";
  appBox.style.display="block";
  updateUI();
}

function updateUI(){
  balance.innerText = userData.balance;
  level.innerText = userData.level;
  inviteLink.innerText = location.href+"?ref="+userData.invite;
}

// ================= TASKS =================
window.startTask = async (id)=>{
  if(currentTask) return alert("Ù‡Ù†Ø§Ùƒ Ù…Ù‡Ù…Ø© ØªØ¹Ù…Ù„ Ø­Ø§Ù„ÙŠØ§");
  const now = Date.now();

  if(userData.tasks[id] && now - userData.tasks[id] < 86400000)
    return alert("Ø§Ø±Ø¬Ø¹ Ø¨Ø¹Ø¯ 24 Ø³Ø§Ø¹Ø©");

  currentTask = true;
  let time = 30;
  const btn = document.getElementById(id);
  btn.innerText = time;

  const timer = setInterval(async ()=>{
    time--;
    btn.innerText=time;
    if(time<=0){
      clearInterval(timer);
      btn.innerText="âœ” ØªÙ…Øª";
      btn.disabled=true;
      currentTask=false;

      userData.balance+=10;
      userData.tasks[id]=Date.now();

      if(userData.balance>=50) userData.level=2;

      await updateDoc(doc(db,"users",auth.currentUser.uid),{
        balance:userData.balance,
        tasks:userData.tasks,
        level:userData.level
      });

      updateUI();
    }
  },1000);
};

// ================= SETTINGS =================
window.openSettings=()=>{settings.style.display="block";appBox.style.display="none";}
window.back=()=>{settings.style.display="none";appBox.style.display="block";}
window.saveWallet=async()=>{
  userData.wallet=wallet.value;
  await updateDoc(doc(db,"users",auth.currentUser.uid),{wallet:userData.wallet});
  alert("ØªÙ… Ø§Ù„Ø­ÙØ¸");
}
window.logout=async()=>{
  await signOut(auth);
  location.reload();
}

</script>

<style>
body{
  margin:0;
  font-family:'Segoe UI';
  background:linear-gradient(135deg,#0f2027,#203a43,#2c5364);
  color:#fff;
}
.box{
  max-width:400px;
  margin:30px auto;
  background:#111;
  border-radius:15px;
  padding:20px;
  animation:fade .5s;
}
input,button{
  width:100%;
  padding:12px;
  margin:8px 0;
  border-radius:8px;
  border:none;
}
button{
  background:#00c853;
  color:#000;
  font-weight:bold;
}
.task{
  background:#222;
  padding:12px;
  border-radius:10px;
  margin:8px 0;
  display:flex;
  justify-content:space-between;
}
.settings-btn{
  position:fixed;
  right:20px;
  bottom:20px;
  background:#00c853;
  color:#000;
  width:55px;
  height:55px;
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:22px;
}
@keyframes fade{from{opacity:0}to{opacity:1}}
</style>
</head>

<body>

<!-- AUTH -->
<div class="box" id="authBox">
  <h2>ğŸ” MaliApp</h2>
  <input id="emailInput" placeholder="Email">
  <input id="passInput" type="password" placeholder="Password">
  <button onclick="register()">ØªØ³Ø¬ÙŠÙ„</button>
  <button onclick="login()">Ø¯Ø®ÙˆÙ„</button>
</div>

<!-- APP -->
<div class="box" id="appBox" style="display:none">
  <h3>ğŸ’° Ø§Ù„Ø±ØµÙŠØ¯: <span id="balance">0</span></h3>
  <h4>â­ Ø§Ù„Ù…Ø³ØªÙˆÙ‰: <span id="level">1</span></h4>
  <p>ğŸ”— Ø±Ø§Ø¨Ø·Ùƒ: <span id="inviteLink"></span></p>

  <div class="task">Ù…Ù‡Ù…Ø© 1 <button id="t1" onclick="startTask('t1')">Ø§Ø¨Ø¯Ø£</button></div>
  <div class="task">Ù…Ù‡Ù…Ø© 2 <button id="t2" onclick="startTask('t2')">Ø§Ø¨Ø¯Ø£</button></div>
  <div class="task">Ù…Ù‡Ù…Ø© 3 <button id="t3" onclick="startTask('t3')">Ø§Ø¨Ø¯Ø£</button></div>
  <div class="task">Ù…Ù‡Ù…Ø© 4 <button id="t4" onclick="startTask('t4')">Ø§Ø¨Ø¯Ø£</button></div>
  <div class="task">Ù…Ù‡Ù…Ø© 5 <button id="t5" onclick="startTask('t5')">Ø§Ø¨Ø¯Ø£</button></div>
</div>

<!-- SETTINGS -->
<div class="box" id="settings" style="display:none">
  <h3>âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</h3>
  <input id="wallet" placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ø­ÙØ¸Ø©">
  <button onclick="saveWallet()">Ø­ÙØ¸</button>
  <button onclick="logout()">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
  <button onclick="back()">Ø±Ø¬ÙˆØ¹</button>
</div>

<div class="settings-btn" onclick="openSettings()">
  <i class="fa fa-gear"></i>
</div>

</body>
</html>
