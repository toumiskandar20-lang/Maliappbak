<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>MaliApp</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">

<style>
body{
  margin:0;
  font-family:Arial;
  background:linear-gradient(135deg,#0f2027,#203a43,#2c5364);
  color:#fff;
}
.box{
  max-width:420px;
  margin:25px auto;
  background:#111;
  border-radius:16px;
  padding:20px;
}
input,button{
  width:100%;
  padding:12px;
  margin:8px 0;
  border-radius:8px;
  border:none;
}
button{
  background:#00c853;
  font-weight:bold;
  cursor:pointer;
}
.task,.history-card,.level-card,.wallet-box{
  background:#222;
  padding:12px;
  border-radius:10px;
  margin:8px 0;
  display:flex;
  justify-content:space-between;
  align-items:center;
}
.badge{
  padding:4px 10px;
  border-radius:12px;
  font-size:12px;
}
.pending{background:#ff9800}
.approved{background:#00c853}
.rejected{background:#d50000}
.copy-btn{
  background:#333;
  color:#fff;
  padding:6px 10px;
  border-radius:6px;
  cursor:pointer;
}
.hidden{display:none}
.toast{
  position:fixed;
  bottom:30px;
  left:50%;
  transform:translateX(-50%);
  background:#00c853;
  color:#000;
  padding:14px 22px;
  border-radius:30px;
  font-weight:bold;
  display:none;
  z-index:999;
}
.settings-btn{
  position:fixed;
  right:20px;
  bottom:20px;
  width:55px;
  height:55px;
  border-radius:50%;
  background:#00c853;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:22px;
  color:#000;
}
.level-card p{
  font-size:14px;
  opacity:.9;
}
.level-card h4{
  margin-bottom:8px;
}
/* LEVEL UP POPUP */
.levelup-overlay{
  position:fixed;
  top:0;
  left:0;
  width:100%;
  height:100%;
  background:rgba(0,0,0,.75);
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:9999;
}
.levelup-popup{
  background:#111;
  width:90%;
  max-width:360px;
  padding:30px 20px;
  border-radius:18px;
  text-align:center;
  animation:popupScale .4s ease;
}
.levelup-icon{
  width:80px;
  height:80px;
  margin:auto;
  background:linear-gradient(135deg,#00c853,#b2ff59);
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:34px;
  color:#000;
  margin-bottom:15px;
}
@keyframes popupScale{
  from{transform:scale(.7);opacity:0}
  to{transform:scale(1);opacity:1}
}
.levelup-overlay{display:none;}
.levelup-overlay.show{display:flex;}
</style>
</head>

<body>

<!-- AUTH -->
<div class="box" id="authBox">
  <h2>ğŸ” MaliApp</h2>
  <input id="email" placeholder="Email">
  <input id="password" type="password" placeholder="Password">
  <button onclick="openRegister()">ØªØ³Ø¬ÙŠÙ„ Ø­Ø³Ø§Ø¨</button>
  <button onclick="login()">ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„</button>
</div>

<!-- REGISTER -->
<div class="box hidden" id="registerBox">
  <h2>ğŸ“ Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯</h2>
  <input id="regEmail" type="email" placeholder="ğŸ“§ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ">
  <input id="regPhone" type="tel" placeholder="ğŸ“± Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ">
  <input id="regPassword" type="password" placeholder="ğŸ”‘ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
  <input id="regConfirm" type="password" placeholder="ğŸ”‘ ØªØ£ÙƒÙŠØ¯ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
  <input id="regInvite" placeholder="ğŸ†” Ù…Ø¹Ø±Ù ØµØ§Ø­Ø¨ Ø§Ù„Ø¯Ø¹ÙˆØ© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)">
  <button onclick="submitRegister()">âœ… ØªØ³Ø¬ÙŠÙ„</button>
  <button onclick="backToLogin()">â¬… Ø±Ø¬ÙˆØ¹</button>
</div>

<!-- TOAST -->
<div class="toast" id="welcomeToast">ğŸ‰ Ù…Ø±Ø­Ø¨Ù‹Ø§ Ø¨Ùƒ ÙÙŠ MaliApp!</div>

<!-- LEVEL UP POPUP -->
<div class="levelup-overlay" id="levelUpOverlay">
  <div class="levelup-popup">
    <div class="levelup-icon">
      <i class="fa-solid fa-trophy"></i>
    </div>
    <h2>ØªÙ…Øª Ø§Ù„ØªØ±Ù‚ÙŠØ© ğŸ‰</h2>
    <p>ØªÙ‡Ø§Ù†ÙŠÙ†Ø§! Ù„Ù‚Ø¯ ÙˆØµÙ„Øª Ø¥Ù„Ù‰<br><strong>Ø§Ù„Ù…Ø³ØªÙˆÙ‰ <span id="popupLevel"></span></strong></p>
    <button onclick="closeLevelUp()">Ù…ØªØ§Ø¨Ø¹Ø©</button>
  </div>
</div>

<!-- APP -->
<div class="box hidden" id="appBox">
  <h3><i class="fa-solid fa-wallet" style="color:#00c853;margin-right:8px;"></i> Ø§Ù„Ø±ØµÙŠØ¯: <span id="balance">0</span></h3>
  <h4><i class="fa-solid fa-layer-group" style="color:#ffd700;margin-right:8px;"></i> Ø§Ù„Ù…Ø³ØªÙˆÙ‰: <span id="level">1</span></h4>

  <button onclick="openProfile()"><i class="fa-solid fa-user" style="color:#00c853;font-size:18px;"></i> Ø¨Ø±ÙˆÙØ§ÙŠÙ„ÙŠ</button>
  <button onclick="openSettings()">âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
  <button onclick="openWithdraw()">ğŸ’¸ Ø·Ù„Ø¨ Ø³Ø­Ø¨</button>
  <button onclick="openTopup()">ğŸ’³ ØªØ¹Ø¨Ø¦Ø© Ø±ØµÙŠØ¯</button>
  <button onclick="openUpgrade()">ğŸš€ ØªØ±Ù‚ÙŠØ© Ù…Ø³ØªÙˆÙ‰</button>

  
  <h3>âš½ Ø§Ù„Ù…Ø¨Ø§Ø±ÙŠØ§Øª Ø§Ù„ÙŠÙˆÙ…ÙŠØ©</h3>
  <div id="matchesBox"></div>
</div>

<!-- WITHDRAW -->
<div class="box hidden" id="withdrawBox">
  <h3>ğŸ’¸ Ø·Ù„Ø¨ Ø³Ø­Ø¨</h3>
  <input id="walletInput" placeholder="Wallet address">
  <button class="copy-btn" onclick="copyWallet()">ğŸ“‹ Ù†Ø³Ø® Ø§Ù„Ù…Ø­ÙØ¸Ø©</button>
  <input id="withdrawAmount" type="number" placeholder="Ø§Ù„Ù…Ø¨Ù„Øº">
  <button onclick="setMax()">MAX</button>
  <button onclick="submitWithdraw()">âœ… ØªÙ†ÙÙŠØ°</button>
  <h4>ğŸ“œ Ø³Ø¬Ù„ Ø§Ù„Ø³Ø­Ø¨</h4>
  <div id="withdrawHistory"></div>
  <button onclick="back()">â¬… Ø±Ø¬ÙˆØ¹</button>
</div>

<!-- PROFILE -->
<div class="box hidden" id="profileBox">
  <h3>ğŸ‘¤ Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„</h3>
  <p>ğŸ“§ Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„:</p><div class="task"><span id="profileEmail"></span></div>
  <p>ğŸ’° Ø§Ù„Ø±ØµÙŠØ¯:</p><div class="task"><span id="profileBalance"></span></div>
  <p>ğŸ†” Ù…Ø¹Ø±Ù Ø§Ù„Ø­Ø³Ø§Ø¨ (UID):</p><div class="task"><span id="profileUID"></span></div>
  <p>ğŸ”— Ø±Ø§Ø¨Ø· Ø§Ù„Ø¯Ø¹ÙˆØ© Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ:</p>
  <div class="task"><span id="inviteLink" style="font-size:13px;word-break:break-all"></span><button class="copy-btn" onclick="copyInvite()">ğŸ“‹ Ù†Ø³Ø®</button></div>
  <button onclick="backFromProfile()">â¬… Ø±Ø¬ÙˆØ¹</button>
</div>

<!-- SETTINGS -->
<div class="box hidden" id="settingsBox">
  <h3>âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</h3>
  <div class="level-card">
    <h4>ğŸ‘¤ Ø§Ù„Ø­Ø³Ø§Ø¨</h4>
    <p>ğŸ“§ Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„: <span id="setEmail"></span></p>
    <p>ğŸ“± Ø§Ù„Ù‡Ø§ØªÙ: <span id="setPhone"></span></p>
    <p>ğŸ†” UID: <span id="setUID"></span></p>
  </div>
  <div class="level-card">
    <h4>ğŸ” Ø§Ù„Ø£Ù…Ø§Ù†</h4>
    <input id="newPassword" type="password" placeholder="ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø¬Ø¯ÙŠØ¯Ø©">
    <button onclick="changePassword()">ğŸ”‘ ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</button>
    <button style="background:#d50000;color:#fff" onclick="logout()">ğŸšª ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
  </div>
  <div class="level-card">
    <h4>ğŸ¨ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚</h4>
    <label><input type="checkbox" id="notifyToggle"> ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</label><br><br>
    <label><input type="checkbox" id="darkToggle"> Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¯Ø§ÙƒÙ†</label>
  </div>
  <div class="level-card">
    <h4>â„¹ï¸ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª</h4>
    <p>MaliApp</p>
    <p>Ø§Ù„Ø¥ØµØ¯Ø§Ø±: 1.0.0</p>
  </div>
  <button onclick="backFromSettings()">â¬… Ø±Ø¬ÙˆØ¹</button>
</div>

<!-- TOPUP -->
<div class="box hidden" id="topupBox">
  <h3>ğŸ’³ ØªØ¹Ø¨Ø¦Ø© Ø±ØµÙŠØ¯</h3>
  <div class="wallet-box">
    <span id="walletText">TE3THEisH6nttHBWtJiKpreaxvPGt5sZVW</span>
    <span class="copy-btn" onclick="copyTopup()">ğŸ“‹</span>
  </div>
  <button onclick="back()">â¬… Ø±Ø¬ÙˆØ¹</button>
</div>

<!-- UPGRADE -->
<div class="box hidden" id="upgradeBox">
  <h3>ğŸš€ ØªØ±Ù‚ÙŠØ© Ø§Ù„Ù…Ø³ØªÙˆÙ‰</h3>
  <div class="level-card"><div>Ø§Ù„Ù…Ø³ØªÙˆÙ‰ 2 â€” 230 Ù…Ø§Ù„ÙŠ</div><button onclick="upgradeLevel(2)">ØªØ±Ù‚ÙŠØ©</button></div>
  <div class="level-card"><div>Ø§Ù„Ù…Ø³ØªÙˆÙ‰ 3 â€” 590 Ù…Ø§Ù„ÙŠ</div><button onclick="upgradeLevel(3)">ØªØ±Ù‚ÙŠØ©</button></div>
  <button onclick="back()">â¬… Ø±Ø¬ÙˆØ¹</button>
</div>

<!-- LEVEL UP SOUND -->
<audio id="levelUpSound" preload="auto"><source src="level-up.mp3" type="audio/mpeg"></audio>

<div class="toast" id="toast">âœ… ØªÙ… Ø§Ù„Ù†Ø³Ø®</div>
<div class="settings-btn" onclick="logout()"><i class="fa fa-sign-out"></i></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
import { getFirestore, doc, setDoc, getDoc, updateDoc, addDoc, collection, query, where, serverTimestamp, onSnapshot } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

// 10-15: Ø¥Ø¹Ø¯Ø§Ø¯ Firebase
const firebaseConfig = {
  apiKey:"AIzaSyBfMUa-8vsUZ_1r5F79iSKOKqMre99lwbI",
  authDomain:"maliapp-63f91.firebaseapp.com",
  projectId:"maliapp-63f91"
};
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

// 20-23: Ù…ØªØºÙŠØ±Ø§Øª Ø¹Ø§Ù…Ø©
let userData = {}, userBets = {};
const levelUpSound = document.getElementById("levelUpSound");

// 26-30: Ø§Ù„Ù…Ø³ØªÙˆÙŠØ§Øª
const LEVELS = {
  1:{tasks:5,reward:10},
  2:{tasks:11,reward:15,price:230},
  3:{tasks:23,reward:20,price:590}
};

// 33-41: Ø§Ù„Ù…Ø¨Ø§Ø±ÙŠØ§Øª Ø§Ù„ÙŠÙˆÙ…ÙŠØ©
const matches = [
  {id:1, teamA:"ØªÙˆÙ†Ø³", teamB:"Ø§Ù„Ù…ØºØ±Ø¨", startTime:"2025-12-25T18:00:00+01:00", endTime:"2025-12-25T20:00:00+01:00", result:null},
  {id:2, teamA:"Ø§Ù„Ù…ØºØ±Ø¨", teamB:"Ù…ØµØ±", startTime:"2025-12-25T21:00:00+01:00", endTime:"2025-12-25T23:00:00+01:00", result:null}
];

// 45-48: ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
function updateUI(){
  balance.innerText = userData.balance;
  level.innerText = userData.level;
}

// ==================== AUTH ====================

// 53-60: ØªØ³Ø¬ÙŠÙ„ Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯
window.submitRegister = async () => {
  const email = regEmail.value.trim();
  const phone = regPhone.value.trim();
  const pass = regPassword.value;
  const confirm = regConfirm.value;
  const invite = regInvite.value.trim();

  if(!email||!phone||!pass||!confirm) return alert("âŒ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„");
  if(pass!==confirm) return alert("âŒ ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± Ù…ØªØ·Ø§Ø¨Ù‚Ø©");

  try{
    const cred = await createUserWithEmailAndPassword(auth,email,pass);
    await setDoc(doc(db,"users",cred.user.uid),{
      email, phone, inviteCode:invite||null, balance:0, level:1, tasks:{}, createdAt:serverTimestamp()
    });
    welcomeToast.style.display="block";
    setTimeout(()=>{welcomeToast.style.display="none";},3000);
    registerBox.classList.add("hidden");
    appBox.classList.remove("hidden");
  }catch(err){alert("âŒ "+err.message);}
};

// 63-64: ÙØªØ­ ØµÙØ­Ø© Ø§Ù„ØªØ³Ø¬ÙŠÙ„ ÙˆØ§Ù„Ø¹ÙˆØ¯Ø©
window.openRegister = ()=>{authBox.classList.add("hidden"); registerBox.classList.remove("hidden");};
window.backToLogin = ()=>{registerBox.classList.add("hidden"); authBox.classList.remove("hidden");};

// 67-68: ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„
window.login = async ()=> signInWithEmailAndPassword(auth,email.value,password.value);

// 71-77: Ø­Ø§Ù„Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
onAuthStateChanged(auth, async u=>{
  if(!u) return;
  userData = (await getDoc(doc(db,"users",u.uid))).data();
  authBox.classList.add("hidden");
  appBox.classList.remove("hidden");
  updateUI();
  loadMatches();
});

// ==================== WITHDRAW ====================

// 83-87: ÙØªØ­ ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø³Ø­Ø¨
window.openWithdraw = ()=> {
  appBox.classList.add("hidden");
  withdrawBox.classList.remove("hidden");
  loadWithdrawHistory();
};

// 88: ØªØ¹ÙŠÙŠÙ† MAX
window.setMax = ()=> withdrawAmount.value = userData.balance;

// 89-96: Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø³Ø­Ø¨
window.submitWithdraw = async ()=>{
  const a = Number(withdrawAmount.value);
  if(a<=0||a>userData.balance) return alert("âŒ Ù…Ø¨Ù„Øº ØºÙŠØ± ØµØ§Ù„Ø­");
  userData.balance -= a;
  await addDoc(collection(db,"withdrawals"), {userId:auth.currentUser.uid, amount:a, status:"pending", createdAt:serverTimestamp()});
  await updateDoc(doc(db,"users",auth.currentUser.uid), userData);
  updateUI();
  loadWithdrawHistory();
};

// 97-106: ØªØ­Ù…ÙŠÙ„ Ø³Ø¬Ù„ Ø§Ù„Ø³Ø­Ø¨
function loadWithdrawHistory(){
  const q = query(collection(db,"withdrawals"), where("userId","==",auth.currentUser.uid));
  onSnapshot(q,snap=>{
    withdrawHistory.innerHTML="";
    snap.forEach(d=>{
      const w = d.data();
      let cls="pending", txt="Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©";
      if(w.status==="approved"){cls="approved"; txt="ØªÙ…Øª Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©";}
      if(w.status==="rejected"){cls="rejected"; txt="Ù…Ø±ÙÙˆØ¶";}
      withdrawHistory.innerHTML += `<div class="history-card"><div>${w.amount} ğŸ’µ</div><span class="badge ${cls}">${txt}</span></div>`;
    });
  });
}

// ==================== NAV ====================

// 110-115: Ø§Ù„ØªÙ†Ù‚Ù„ Ø¨ÙŠÙ† Ø§Ù„ØµÙØ­Ø§Øª
window.openTopup = ()=>{appBox.classList.add("hidden"); topupBox.classList.remove("hidden");};
window.openUpgrade = ()=>{appBox.classList.add("hidden"); upgradeBox.classList.remove("hidden");};
window.back = ()=>{
  withdrawBox.classList.add("hidden"); topupBox.classList.add("hidden"); upgradeBox.classList.add("hidden");
  appBox.classList.remove("hidden");
};

// ==================== COPY ====================

// 120-127
window.copyWallet = ()=> navigator.clipboard.writeText(walletInput.value||"");
window.copyTopup = ()=>{
  navigator.clipboard.writeText(walletText.innerText);
  toast.style.display="block";
  setTimeout(()=>toast.style.display="none",2000);
};
window.copyInvite = ()=>{navigator.clipboard.writeText(inviteLink.innerText); alert("âœ… ØªÙ… Ù†Ø³Ø® Ø±Ø§Ø¨Ø· Ø§Ù„Ø¯Ø¹ÙˆØ©");};

// ==================== UPGRADE ====================

// 131-137
window.upgradeLevel = async (lvl)=>{
  const p = LEVELS[lvl].price;
  if(userData.balance < p) return alert("âŒ Ø±ØµÙŠØ¯ ØºÙŠØ± ÙƒØ§Ù");
  userData.balance -= p;
  userData.level = lvl;
  await updateDoc(doc(db,"users",auth.currentUser.uid), userData);
  updateUI(); 
  loadMatches(); 
  back();
  showLevelUp(lvl);
};

// ==================== LOGOUT ====================

// 139
window.logout = async ()=>{await signOut(auth); location.reload();};

// ==================== PASSWORD ====================

// 142-148
window.changePassword = async ()=>{
  const pass = newPassword.value;
  if(pass.length < 6) return alert("âŒ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† 6 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„");
  try{
    await auth.currentUser.updatePassword(pass);
    alert("âœ… ØªÙ… ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±");
    newPassword.value="";
  }catch(err){alert("âŒ Ø£Ø¹Ø¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø«Ù… Ø­Ø§ÙˆÙ„ Ù…Ø¬Ø¯Ø¯Ù‹Ø§");}
};

// ==================== SETTINGS ====================

// 151-155
window.openSettings = ()=>{
  appBox.classList.add("hidden");
  settingsBox.classList.remove("hidden");
  setEmail.innerText = auth.currentUser.email;
  setUID.innerText = auth.currentUser.uid;
  setPhone.innerText = userData.phone || "ØºÙŠØ± Ù…ØªÙˆÙØ±";
};
window.backFromSettings = ()=>{settingsBox.classList.add("hidden"); appBox.classList.remove("hidden");};

// ==================== LEVEL UP ====================

// 160-165
window.showLevelUp = (level)=>{
  levelUpSound.play();
  popupLevel.innerText = level;
  levelUpOverlay.classList.add("show");
  setTimeout(()=>{levelUpOverlay.classList.remove("show");},3000);
};
window.closeLevelUp = ()=>{levelUpOverlay.classList.remove("show");};

// ==================== PROFILE ====================

// 169-176
window.openProfile = ()=>{
  appBox.classList.add("hidden"); 
  profileBox.classList.remove("hidden");
  const user = auth.currentUser;
  profileEmail.innerText = user.email;
  profileBalance.innerText = userData.balance + " ğŸ’µ";
  profileUID.innerText = user.uid;
  inviteLink.innerText = `${location.origin}${location.pathname}?ref=${user.uid}`;
};
window.backFromProfile = ()=>{profileBox.classList.add("hidden"); appBox.classList.remove("hidden");};

// ==================== MATCHES & BET ====================

// 181-194
window.placeBet = (matchId, bet)=>{
  const match = matches.find(m => m.id===matchId);
  const now = new Date();
  if(now >= new Date(match.startTime)){ alert("âŒ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªÙƒÙ‡Ù† Ø¨Ø¹Ø¯ Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø©"); return; }
  userBets[matchId] = bet;
  loadMatches();
};

// 196-205
function loadMatches(){
  matchesBox.innerHTML="";
  const now = new Date();
  matches.forEach(match=>{
    const start = new Date(match.startTime);
    const canBet = now < start;
    matchesBox.innerHTML += `
      <div class="task">
        ${match.teamA} ğŸ†š ${match.teamB} 
        <br><small>Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©: ${start.toLocaleString()}</small>
        <div>
          <button onclick="placeBet(${match.id}, '1')" ${!canBet?'':'disabled'}>1</button>
          <button onclick="placeBet(${match.id}, 'X')" ${!canBet?'':'disabled'}>X</button>
          <button onclick="placeBet(${match.id}, '2')" ${!canBet?'':'disabled'}>2</button>
        </div>
      </div>
    `;
  });
}

// 208-221: ÙØ­Øµ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ ÙƒÙ„ Ø¯Ù‚ÙŠÙ‚Ø©
async function checkMatchResults(){
  const now = new Date();
  for(const match of matches){
    const end = new Date(match.endTime);
    if(!match.result || now<end) continue;
    if(userBets[match.id] && userBets[match.id] === match.result){
      let reward = 0;
      if(userData.level===1) reward=0.5;
      else if(userData.level===2) reward=1.5;
      else if(userData.level===3) reward=3;
      userData.balance += reward;
      await updateDoc(doc(db,"users",auth.currentUser.uid), userData);
      updateUI();
      alert(`ğŸ† Ù…Ø¨Ø±ÙˆÙƒ! Ø±Ø¨Ø­Ùƒ ${reward} Ù…Ø§Ù„ÙŠ Ù…Ù† Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø©: ${match.teamA} vs ${match.teamB}`);
    }
  }
}
setInterval(checkMatchResults,60*1000);
</script>
</body>
</html>
